<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Socket.IO chat</title>

    
    <!--<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap-theme.min.css">
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>-->

    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/style.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/jquery.mobile.flatui.css" />

    <script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <div id="loginbox" style="display:block">
        <div style="margin-left: auto;margin-right: auto;margin-top: 100px;width: 20em;">
            <div class="input-group">
                <span class="input-group-addon "><span class="glyphicon glyphicon-user"> </span></span>
                <input id="username" type="text" class="form-control" placeholder="用户名" aria-describedby="basic-addon1">
            </div><br>
            <button id="login" type="button" style="width:280px;" class="btn btn-default btn-info">加 入</button>
        </div>
    </div>
    <div id="roombox" style="display:none">
        <div style="margin-left: auto;margin-right: auto;margin-top: 100px;width: 20em;">
            <button id="room" type="button" style="width:280px;margin-top: 10px;" class="btn btn-default btn-info">房间1</button>
            <button id="room" type="button" style="width:280px;margin-top: 10px;" class="btn btn-default btn-info">房间2</button>
            <button id="room" type="button" style="width:280px;margin-top: 10px;" class="btn btn-default btn-info">房间3</button>
            <button id="room" type="button" style="width:280px;margin-top: 10px;" class="btn btn-default btn-info">房间4</button>
        </div>
    </div>
    <div id="chatbox" style="display:none">
        <div data-role="header" class="header linear-g">
            <a id="joinInfo" class="text-center col-xs-8"></a>
            <a href="#panel-right" data-iconpos="notext" class="glyphicon glyphicon-user col-xs-2 text-left"> </a>
        </div>
        <!--<p id="loginInfo"></p>
        <p id="joinInfo"></p>-->

        <div data-role="content" class="container" role="main">
            <ul class="content-reply-box mg10" id="messages">
            </ul>
        </div>

        <form action="">
            <input id="m" autocomplete="off" /><button id="sendMsg">Send</button><button id="leave">Leave</button>
    </div>

    <script>
        function prependeEven(text)
        {
            var code1 = '<li class="even"><div class="reply-content-box"><div class="reply-content prr"><span class="arrow">&nbsp;</span>';
            var code2 = '</div></div></li>';
            var code = code1 + text + code2;
            $('ul#messages').prepend(code);
        }
        function prependeOdd(text)
        {
            var code1 = '<li class="odd"><div class="reply-content-box"><div class="reply-content prl"><span class="arrow">&nbsp;</span>';
            var code2 = '</div></div></li>';
            var code = code1 + text + code2;
            $('ul#messages').prepend(code);
        }
        function getUUid()
        {
            return new Date().getTime()+""+Math.floor(Math.random()*899+100);
        }

    </script>

    <script>
        var socket = io();
        var username;
        var userid;
        var room;
        $('button#login').click(function(){
            username = $('input#username').val();
            userid = getUUid();
            socket.emit('login', {'username':username, 'userid':userid});
            $('div#loginbox').attr("style", "display:none");
            $('div#roombox').attr("style", "display:block");
            $('div#chatbox').attr("style", "display:none");
            return false;
        });
        $('button#leave').click(function(){
            // console.log('room : ' + room + ' username : ' + username);
            socket.emit('leave', {'room':room, 'username':username, 'userid':userid});
            $('div#loginbox').attr("style", "display:none");
            $('div#roombox').attr("style", "display:block");
            $('div#chatbox').attr("style", "display:none");
            return false;
        });
        $('button#room').click(function(){
            room = $(this).text();
            // console.log('room : ' + room + ' username : ' + username);
            socket.emit('join', {'room':room, 'username':username, 'userid':userid});
            $('div#loginbox').attr("style", "display:none");
            $('div#roombox').attr("style", "display:none");
            $('div#chatbox').attr("style", "display:block");
            return false;
        });
        $('form').submit(function(){
<<<<<<< HEAD
            var smg = $("#m").val();
            if(smg == null || smg == "" || smg == undefined){
                return false;
            }
            socket.emit('chat message', $('#m').val());
=======
            var message = {
                'username' : username,
                'userid' : userid,
                'room' : room,
                'content' : $('#m').val()
            };
            if(message.content != '')
            {
                socket.emit('chat message', message);
            }
>>>>>>> 9b7876b40608c560237c4a5e9407a839e21580c6
            $('#m').val('');
            return false;
        });
        socket.on('chat message', function(msg){
            console.log("userid : " + msg.userid + ' ori : ' + userid);
            if(msg.userid == userid)
                prependeEven(msg.content);
            else
                prependeOdd(msg.content);
            // $('ul#messages').prepend($('<li>').text(msg.username + ' : ' + msg.content));
        });
        socket.on('loginInfo', function(obj){
            $('p#loginInfo').text("在线人数 ：" + obj.onlineCount);
        });
        socket.on('logoutInfo', function(obj){
            $('p#loginInfo').text("在线人数 ：" + obj.onlineCount);
        });
        socket.on('sysInfo', function(msg){
            $('ul#messages').prepend($('<li>').text(msg));
        });
        socket.on('joinInfo', function(obj){
            $('a#joinInfo').text("房间内人数 ：" + obj.count);
        });
        socket.on('leaveInfo', function(obj){
            $('a#joinInfo').text("房间内人数 ：" + obj.count);
        });
    </script>


</body>

</html>